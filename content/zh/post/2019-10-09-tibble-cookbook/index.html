---
title: tibble cookbook
author: Xiaotao Shen
date: '2019-11-09'
slug: ''
categories:
  - R
tags:
  - Blog
  - Chinese
image:
  caption: ''
  focal_point: ''
output:
  blogdown::html_page:
    toc: true
    number_sections: true
---


<div id="TOC">
<ul>
<li><a href="#创建一个tibble"><span class="toc-section-number">1</span> 创建一个tibble</a><ul>
<li><a href="#tibble函数"><span class="toc-section-number">1.1</span> <code>tibble()</code>函数</a></li>
<li><a href="#as_tibble函数"><span class="toc-section-number">1.2</span> <code>as_tibble()</code>函数</a></li>
<li><a href="#tribble函数"><span class="toc-section-number">1.3</span> <code>tribble()</code>函数</a></li>
<li><a href="#enframe函数"><span class="toc-section-number">1.4</span> <code>enframe()</code>函数</a></li>
</ul></li>
<li><a href="#tibble显示控制"><span class="toc-section-number">2</span> tibble显示控制</a><ul>
<li><a href="#使用print函数"><span class="toc-section-number">2.1</span> 使用<code>print()</code>函数</a></li>
<li><a href="#修改options默认参数"><span class="toc-section-number">2.2</span> 修改<code>options()</code>默认参数</a></li>
</ul></li>
<li><a href="#tibble切片操作"><span class="toc-section-number">3</span> tibble切片操作</a></li>
</ul>
</div>

<div id="创建一个tibble" class="section level1">
<h1><span class="header-section-number">1</span> 创建一个tibble</h1>
<div id="tibble函数" class="section level2">
<h2><span class="header-section-number">1.1</span> <code>tibble()</code>函数</h2>
<p>使用<code>tibble()</code>可以创建新的<code>tibble</code>对象,但是一般用来创建比较简单的tibble。</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 3.6.1</code></pre>
<pre><code>## -- Attaching packages -------------------------------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.2.1     v purrr   0.3.2
## v tibble  2.1.3     v dplyr   0.8.3
## v tidyr   1.0.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.6.1</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 3.6.1</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.6.1</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.6.1</code></pre>
<pre><code>## -- Conflicts ----------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>a &lt;- 1
b &lt;- 2:6
tibble(a, b)</code></pre>
<pre><code>## # A tibble: 5 x 2
##       a     b
##   &lt;dbl&gt; &lt;int&gt;
## 1     1     2
## 2     1     3
## 3     1     4
## 4     1     5
## 5     1     6</code></pre>
<pre class="r"><code># 使用下列方法修改列名
tibble(column1 = a, column2 = b)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   column1 column2
##     &lt;dbl&gt;   &lt;int&gt;
## 1       1       2
## 2       1       3
## 3       1       4
## 4       1       5
## 5       1       6</code></pre>
<p>需要注意的是,如果输入的vector长度不一致,只有其中某一个长度为1,才会循环补齐,否则报错.</p>
<p><code>tibble()</code>函数有一个参数可以注意一下:<code>.name_repair</code>,用来控制对那些不如何规矩的列名如何处理.常用的一共有4个选项:</p>
<ul>
<li><p><strong>minimal</strong> 对列名不做任何处理,既不做列名检查,也不做处理.</p></li>
<li><p><strong>unique</strong> 保证列名都是唯一的并且不能为空.</p></li>
</ul>
<pre class="r"><code>#如果列名是重复的,会在列名后加入不同的序号.
try(
 tibble(a = 1:3, a = 1:3, 1:3, .name_repair = &quot;unique&quot;) 
)</code></pre>
<pre><code>## New names:
## * a -&gt; a...1
## * a -&gt; a...2</code></pre>
<pre><code>## # A tibble: 3 x 3
##   a...1 a...2 `1:3`
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1     1     1
## 2     2     2     2
## 3     3     3     3</code></pre>
<ul>
<li><strong>check_unique</strong> 这是默认的参数设置,不对列名做修改,只做列名检查.</li>
</ul>
<pre class="r"><code>#如果列名是重复的,则会报错
try(
 tibble(a = 1:3, a = 1:3) 
)</code></pre>
<pre><code>## Error : Column name `a` must not be duplicated.
## Use .name_repair to specify repair.
## Backtrace:
##      x
##   1. +-base::local(...)
##   2. | \-base::eval.parent(substitute(eval(quote(expr), envir)))
##   3. |   \-base::eval(expr, p)
##   4. |     \-base::eval(expr, p)
##   5. +-base::eval(...)
##   6. | \-base::eval(...)
##   7. |   \-rmarkdown::render(...)
##   8. |     \-knitr::knit(...)
##   9. |       \-knitr:::process_file(text, output)
##  10. |         +-base::withCallingHandlers(...)
##  11. |         +-knitr:::process_group(group)
##  12. |         \-knitr:::process_group.block(group)
##  13. |           \-knitr:::call_block(x)
##  14. |             \-knitr:::block_exec(params)
##  15. |               +-knitr:::in_dir(...)
##  16. |               \-knitr:::evaluate(...)
##  17. |                 \-evaluate::evaluate(...)
##  18. |                   \-evaluate:::evaluate_call(...)
##  19. |                     +-evaluate:::timing_fn(...)
##  20. |                     +-base:::handle(...)
##  21. |                     +-base::withCallingHandlers(...)
##  22. |                     +-base::withVisible(eval(expr, envir, enclos))
##  23. |                     \-base::eval(expr, envir, enclos)
##  24. |                       \-base::eval(expr, envir, enclos)
##  25. +-base::try(tibble(a = 1:3, a = 1:3))
##  26. | \-base::tryCatch(...)
##  27. |   \-base:::tryCatchList(expr, classes, parentenv, handlers)
##  28. |     \-base:::tryCatchOne(expr, names, parentenv, handlers[[1L]])
##  29. |       \-base:::doTryCatch(return(expr), name, parentenv, handler)
##  30. \-tibble::tibble(a = 1:3, a = 1:3)
##  31.   \-tibble:::lst_to_tibble(xlq$output, .rows, .name_repair, lengths = xlq$lengths)
##  32.     \-tibble:::set_repaired_names(x, .name_repair)
##  33.       +-rlang::set_names(x, repaired_names(names(x), .name_repair = .name_repair))
##  34.       | \-rlang:::set_names_impl(x, x, nm, ...)
##  35.       |   \-rlang::is_function(nm)
##  36.       |     \-rlang::is_closure(x)
##  37.       \-tibble:::repaired_names(names(x), .name_repair = .name_repair)
##  38.         \-tibble:::check_unique(new_name)</code></pre>
<ul>
<li><strong>universal</strong> 保证列名都是唯一的并且符合R语言语法.</li>
</ul>
<p>如果有相同的列名,会在列名后加入不同的序号.</p>
<pre class="r"><code>#如果列名是重复的,则会报错
try(
 tibble(a = 1:3, a = 1:3, .name_repair = &quot;universal&quot;) 
)</code></pre>
<pre><code>## New names:
## * a -&gt; a...1
## * a -&gt; a...2</code></pre>
<pre><code>## # A tibble: 3 x 2
##   a...1 a...2
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2
## 3     3     3</code></pre>
</div>
<div id="as_tibble函数" class="section level2">
<h2><span class="header-section-number">1.2</span> <code>as_tibble()</code>函数</h2>
<p>使用<code>as_tibble()</code>函数可以将已有的matrix和data.frame转变为tibble对象.</p>
<pre class="r"><code>test1 &lt;- 
  matrix(1:6, ncol = 2)
tibble::as_tibble(test1)</code></pre>
<pre><code>## Warning: `as_tibble.matrix()` requires a matrix with column names or a `.name_repair` argument. Using compatibility `.name_repair`.
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 3 x 2
##      V1    V2
##   &lt;int&gt; &lt;int&gt;
## 1     1     4
## 2     2     5
## 3     3     6</code></pre>
<pre class="r"><code>test2 &lt;- 
  data.frame(a = 1:3, b = 2:4, stringsAsFactors = FALSE)
tibble::as_tibble(test2)</code></pre>
<pre><code>## # A tibble: 3 x 2
##       a     b
##   &lt;int&gt; &lt;int&gt;
## 1     1     2
## 2     2     3
## 3     3     4</code></pre>
<p><code>as_tibble()</code>函数的参数与<code>tibble()</code>大概相同,另外一个需要注意的的参数是:<strong>rownames</strong>,用来控制如何处理原有的行名.如果设置为NULL,则去除掉行名(默认),如果设置为NA,则保留原来的列名.设置为一个string vector,则将其设置为新的列名.</p>
</div>
<div id="tribble函数" class="section level2">
<h2><span class="header-section-number">1.3</span> <code>tribble()</code>函数</h2>
<p>使用<code>tribble()</code>函数可以用另外一种方法来创建tibble对象.</p>
<pre class="r"><code>tibble::tribble(
  ~colA, ~colB,
  ## two columns
  &quot;a&quot;,   1,
  &quot;b&quot;,   2,
  &quot;c&quot;,   3
)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   colA   colB
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         1
## 2 b         2
## 3 c         3</code></pre>
<p>需要注意的是,tibble和data.frame一样,他们中的元素也可以是list.</p>
<pre class="r"><code>tribble(
  ~x,  ~y,
  &quot;a&quot;, 1:3,
  &quot;b&quot;, 4:6
)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   x     y        
##   &lt;chr&gt; &lt;list&gt;   
## 1 a     &lt;int [3]&gt;
## 2 b     &lt;int [3]&gt;</code></pre>
</div>
<div id="enframe函数" class="section level2">
<h2><span class="header-section-number">1.4</span> <code>enframe()</code>函数</h2>
<p><code>enframe()</code>可以将vector转换为tibble,另外有一个相反的函数,<code>deframe()</code>函数,将tibble/data.frame转变为vector.</p>
<pre class="r"><code>enframe(x = 1:3)</code></pre>
<pre><code>## # A tibble: 3 x 2
##    name value
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2
## 3     3     3</code></pre>
<pre class="r"><code>enframe(c(a = 5, b = 7))</code></pre>
<pre><code>## # A tibble: 2 x 2
##   name  value
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         5
## 2 b         7</code></pre>
<pre class="r"><code>enframe(list(one = 1, two = 2:3, three = 4:6))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   name  value    
##   &lt;chr&gt; &lt;list&gt;   
## 1 one   &lt;dbl [1]&gt;
## 2 two   &lt;int [2]&gt;
## 3 three &lt;int [3]&gt;</code></pre>
<p><code>enframe()</code>的第一个参数是<code>x</code>,必须是一个vector或者list,他会将他的每一个元素的名字组成第一列,而其内容作为第二列转变为一个tibble.也就是说其只能用来创建两列的tibble.两列的列名默认为name和value如果想要修改,可以更改两个参数(name和value).</p>
<p>使用<code>deframe()</code>函数将一个一列或者两列的tibble转变为vector或者list.</p>
<pre class="r"><code>deframe(enframe(1:3))</code></pre>
<pre><code>## 1 2 3 
## 1 2 3</code></pre>
<hr />
</div>
</div>
<div id="tibble显示控制" class="section level1">
<h1><span class="header-section-number">2</span> tibble显示控制</h1>
<p>tibble默认情况下只输出前十行内容,列自动适应屏幕宽度,如果想要输出比默认更多的数据,有以下几种方法.</p>
<div id="使用print函数" class="section level2">
<h2><span class="header-section-number">2.1</span> 使用<code>print()</code>函数</h2>
<p>使用<code>print()</code>函数,可以控制行数和列数.</p>
<pre class="r"><code>library(tidyverse)
# 默认显示
nycflights13::flights</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code># 输出15行及所有列数
nycflights13::flights %&gt;% 
  print(n = 15, width = Inf)</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## 11  2013     1     1      558            600        -2      849
## 12  2013     1     1      558            600        -2      853
## 13  2013     1     1      558            600        -2      924
## 14  2013     1     1      558            600        -2      923
## 15  2013     1     1      559            600        -1      941
##    sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##             &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1            819        11 UA        1545 N14228  EWR    IAH        227
##  2            830        20 UA        1714 N24211  LGA    IAH        227
##  3            850        33 AA        1141 N619AA  JFK    MIA        160
##  4           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5            837       -25 DL         461 N668DN  LGA    ATL        116
##  6            728        12 UA        1696 N39463  EWR    ORD        150
##  7            854        19 B6         507 N516JB  EWR    FLL        158
##  8            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9            846        -8 B6          79 N593JB  JFK    MCO        140
## 10            745         8 AA         301 N3ALAA  LGA    ORD        138
## 11            851        -2 B6          49 N793JB  JFK    PBI        149
## 12            856        -3 B6          71 N657JB  JFK    TPA        158
## 13            917         7 UA         194 N29129  JFK    LAX        345
## 14            937       -14 UA        1124 N53441  EWR    SFO        361
## 15            910        31 AA         707 N3DUAA  LGA    DFW        257
##    distance  hour minute time_hour          
##       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             
##  1     1400     5     15 2013-01-01 05:00:00
##  2     1416     5     29 2013-01-01 05:00:00
##  3     1089     5     40 2013-01-01 05:00:00
##  4     1576     5     45 2013-01-01 05:00:00
##  5      762     6      0 2013-01-01 06:00:00
##  6      719     5     58 2013-01-01 05:00:00
##  7     1065     6      0 2013-01-01 06:00:00
##  8      229     6      0 2013-01-01 06:00:00
##  9      944     6      0 2013-01-01 06:00:00
## 10      733     6      0 2013-01-01 06:00:00
## 11     1028     6      0 2013-01-01 06:00:00
## 12     1005     6      0 2013-01-01 06:00:00
## 13     2475     6      0 2013-01-01 06:00:00
## 14     2565     6      0 2013-01-01 06:00:00
## 15     1389     6      0 2013-01-01 06:00:00
## # ... with 3.368e+05 more rows</code></pre>
</div>
<div id="修改options默认参数" class="section level2">
<h2><span class="header-section-number">2.2</span> 修改<code>options()</code>默认参数</h2>
<ul>
<li><p><code>options(tibble.print_max = n, tibble.pring_min = m)</code>:如果多于m行,则只打印出n
行.<code>options(tibble.print_min = Inf)</code>表示总是打印所有行.</p></li>
<li><p><code>options(tibble.width = Inf)</code>表示总是打印所有列,不考虑屏幕的宽度.</p></li>
</ul>
<p><code>options()</code>中所有和<code>tibble</code>相关的参数:</p>
<ol style="list-style-type: decimal">
<li><p><code>tibble.print_max</code>:Row number threshold: Maximum number of rows printed. Set to Inf to always print all rows. Default: 20.</p></li>
<li><p><code>tibble.print_min</code>: 如果设置为m,意思即为如果行数大于m,则只打印出前n行.</p></li>
<li><p><code>tibble.width</code>: 打印列的宽度.默认为NULL,也就是适应屏幕宽度.设置为<code>Inf</code>,则打印出全部列.</p></li>
<li><p><code>tibble.max_extra_cols</code>: Number of extra columns printed in reduced form. Default: 100.</p></li>
<li><p><code>pillar.bold</code>: pillar是柱子的意思.如果设置为TRUE,则列名为粗体,默认为FALSE,因为在terminal中很多字体对粗体支持不够.</p></li>
<li><p><code>pillar.subtle</code>: 是否打印出其他详细的信息,比如总的行和列数.默认为TRUE.</p></li>
<li><p><code>pillar.subtle_num</code>: Use subtle style for insignificant digits? Default: FALSE, is also affected by the pillar.subtle option.</p></li>
<li><p><code>pillar.neg</code>: 是否高亮负值.默认为TRUE.</p></li>
<li><p><code>pillar.sigfig</code>: 高亮那些数字,比如如果设置为3,则会高亮数字3.</p></li>
<li><p><code>pillar.min_title_chars</code>: 列名打印时最小的字符数,默认为15.意味着如果某些列名大于15,则会被截断.设置为<code>Inf</code>,打印出完整的列名.</p></li>
</ol>
<hr />
</div>
</div>
<div id="tibble切片操作" class="section level1">
<h1><span class="header-section-number">3</span> tibble切片操作</h1>
<p>如何取出一个tibble的一列或者几列.</p>
<pre class="r"><code>test &lt;- as_tibble(mtcars)
test[,1, drop = TRUE]</code></pre>
<pre><code>##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2
## [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4
## [29] 15.8 19.7 15.0 21.4</code></pre>
<pre class="r"><code>mtcars[,1]</code></pre>
<pre><code>##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2
## [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4
## [29] 15.8 19.7 15.0 21.4</code></pre>
<p>tibble如果使用<code>[</code>函数来进行选择某一列,则默认出来的还是一个tibble,当然可以使用<code>drop</code>参数来设置为TRUE,让其转变成一个vector.而对于data.frame,则取出一列,默认为vector.</p>
<pre class="r"><code>test$mpg</code></pre>
<pre><code>##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2
## [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4
## [29] 15.8 19.7 15.0 21.4</code></pre>
<pre class="r"><code>test[[&quot;mpg&quot;]]</code></pre>
<pre><code>##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2
## [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4
## [29] 15.8 19.7 15.0 21.4</code></pre>
<p>当然还可以使用<code>$</code>和<code>[[</code>函数,这两个函数取出来的都是vector.</p>
<pre class="r"><code>library(tidyverse)
test %&gt;% 
  pull(mpg)</code></pre>
<pre><code>##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2
## [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4
## [29] 15.8 19.7 15.0 21.4</code></pre>
<p>当然,还可以使用<code>dplyr</code>中的<code>pull()</code>函数,取出来的也是vector.</p>
</div>
