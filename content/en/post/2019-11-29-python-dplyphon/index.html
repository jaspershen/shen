---
title: Python中与dplyr类似的数据处理包
author: Xiaotao Shen
date: 2019-11-29
slug: ''
categories:
 -  Python
tags:
 -  Blog
 -  Chinese
image:
  caption: ''
  focal_point: ''
output:
  blogdown::html_page:
    toc: true
    number_sections: true
---


<div id="TOC">
<ul>
<li><a href="#dplython"><span class="toc-section-number">1</span> dplython</a><ul>
<li><a href="#安装"><span class="toc-section-number">1.1</span> 安装</a></li>
<li><a href="#简单介绍"><span class="toc-section-number">1.2</span> 简单介绍</a></li>
</ul></li>
<li><a href="#dfply"><span class="toc-section-number">2</span> dfply</a><ul>
<li><a href="#安装-1"><span class="toc-section-number">2.1</span> 安装</a></li>
<li><a href="#函数概览"><span class="toc-section-number">2.2</span> 函数概览</a><ul>
<li><a href="#和管道操作符"><span class="toc-section-number">2.2.1</span> <code>&gt;&gt;</code>和<code>&gt;&gt;=</code>管道操作符</a></li>
<li><a href="#section"><span class="toc-section-number">2.2.2</span> </a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="dplython" class="section level1">
<h1><span class="header-section-number">1</span> dplython</h1>
<p><code>dplython</code>是python借鉴R中<code>dplyr</code>包开发的,用于数据tidy的包.基本语法跟R非常像,而且还支持管道函数(操作符<code>&gt;&gt;</code>).对于我这种从R转python的人来说,用起来会更加熟悉和方便.</p>
<p>官网在这.</p>
<p><a href="https://pythonhosted.org/dplython/" class="uri">https://pythonhosted.org/dplython/</a></p>
<div id="安装" class="section level2">
<h2><span class="header-section-number">1.1</span> 安装</h2>
<pre><code>pip install dplython</code></pre>
<p>也可以从github上安装最新开发版本.</p>
<pre><code>pip install git+https://github.com/dodger487/dplython.git</code></pre>
</div>
<div id="简单介绍" class="section level2">
<h2><span class="header-section-number">1.2</span> 简单介绍</h2>
<p>加载所需要的包.</p>
<pre class="python"><code>import pandas as pd
import numpy as np
import dplython as dply
from dplython import (DplyFrame, X, diamonds, select, sift,
  sample_n, sample_frac, head, arrange, mutate, group_by,
  summarize, DelayFunction)</code></pre>
<p>支持管道符操作,但是如果要将每一个操作写作一行,需要使用小括号将其括起来.</p>
<pre class="python"><code>diamonds &gt;&gt; head</code></pre>
<pre><code>##    Unnamed: 0  carat      cut color clarity  ...  table  price     x     y     z
## 0           1   0.23    Ideal     E     SI2  ...   55.0    326  3.95  3.98  2.43
## 1           2   0.21  Premium     E     SI1  ...   61.0    326  3.89  3.84  2.31
## 2           3   0.23     Good     E     VS1  ...   65.0    327  4.05  4.07  2.31
## 3           4   0.29  Premium     I     VS2  ...   58.0    334  4.20  4.23  2.63
## 4           5   0.31     Good     J     SI2  ...   58.0    335  4.34  4.35  2.75
## 
## [5 rows x 11 columns]</code></pre>
<pre class="python"><code>(
diamonds &gt;&gt;
head(5)
)</code></pre>
<pre><code>##    Unnamed: 0  carat      cut color clarity  ...  table  price     x     y     z
## 0           1   0.23    Ideal     E     SI2  ...   55.0    326  3.95  3.98  2.43
## 1           2   0.21  Premium     E     SI1  ...   61.0    326  3.89  3.84  2.31
## 2           3   0.23     Good     E     VS1  ...   65.0    327  4.05  4.07  2.31
## 3           4   0.29  Premium     I     VS2  ...   58.0    334  4.20  4.23  2.63
## 4           5   0.31     Good     J     SI2  ...   58.0    335  4.34  4.35  2.75
## 
## [5 rows x 11 columns]</code></pre>
<p>再<code>dplyr</code>中,进行行筛选的函数为<code>filter()</code>,但是在<code>dplython</code>中,函数名为<code>sift()</code>,暂时不知道为什么要改名,猜想可能是由于和python自带函数冲突.</p>
<p>列名不能直接引用,需要使用dplython中的<code>X</code>来引用.</p>
<blockquote>
<p>X.foo will refer to the “foo” column of the DataFrame in which it is later applied.</p>
</blockquote>
<pre class="python"><code>(
diamonds &gt;&gt; 
sift(X.carat &gt; 4) &gt;&gt; 
select(X.carat, X.cut, X.depth, X.price)
)</code></pre>
<pre><code>##        carat      cut  depth  price
## 25998   4.01  Premium   61.0  15223
## 25999   4.01  Premium   62.5  15223
## 27130   4.13     Fair   64.8  17329
## 27415   5.01     Fair   65.5  18018
## 27630   4.50     Fair   65.8  18531</code></pre>
<pre class="python"><code>(diamonds &gt;&gt;
  sample_n(10) &gt;&gt;
  arrange(X.carat) &gt;&gt;
  select(X.carat, X.cut, X.depth, X.price))
  </code></pre>
<pre><code>##        carat        cut  depth  price
## 20019   0.30       Good   63.9    421
## 30966   0.39  Very Good   63.3    746
## 41006   0.40  Very Good   59.8   1184
## 37574   0.41      Ideal   61.3    990
## 29151   0.41  Very Good   63.5    692
## 37625   0.44    Premium   61.6    990
## 51397   0.72  Very Good   63.5   2369
## 18486   1.00  Very Good   62.3   7528
## 24587   1.58      Ideal   62.0  12897
## 26067   2.25       Good   62.4  15287</code></pre>
<pre class="python"><code>(diamonds &gt;&gt;
  mutate(carat_bin=X.carat.round()) &gt;&gt;
  group_by(X.cut, X.carat_bin) &gt;&gt;
  summarize(avg_price=X.price.mean()))</code></pre>
<pre><code>##           cut  carat_bin     avg_price
## 0        Fair        0.0   1027.979275
## 1        Fair        1.0   3305.754579
## 2        Fair        2.0   9588.269737
## 3        Fair        3.0  13466.823529
## 4        Fair        4.0  15842.666667
## 5        Fair        5.0  18018.000000
## 6        Good        0.0    786.054191
## 7        Good        1.0   3815.307879
## 8        Good        2.0  11096.950321
## 9        Good        3.0  15924.176471
## 10      Ideal        0.0    863.908535
## 11      Ideal        1.0   4213.864948
## 12      Ideal        2.0  12838.984078
## 13      Ideal        3.0  16156.681818
## 14      Ideal        4.0  12587.000000
## 15    Premium        0.0    863.329085
## 16    Premium        1.0   4382.906453
## 17    Premium        2.0  12337.020064
## 18    Premium        3.0  15636.047619
## 19    Premium        4.0  16335.000000
## 20  Very Good        0.0    766.354590
## 21  Very Good        1.0   4135.271007
## 22  Very Good        2.0  12281.851661
## 23  Very Good        3.0  15053.555556
## 24  Very Good        4.0  15984.000000</code></pre>
<p>需要注意的是,使用管道函数,第一行为要处理的数据,第二行开始,都要缩进.</p>
<p>但是作者已经3年没有维护这个包了,所以感觉有点悬,有可能废掉了,所以还是别用了.</p>
</div>
</div>
<div id="dfply" class="section level1">
<h1><span class="header-section-number">2</span> dfply</h1>
<p>另外一个将<code>dplyr</code>移植到python的包是<code>dfply</code>,可能更加可靠一些.</p>
<p>官网如下:</p>
<p><a href="https://github.com/kieferk/dfply#the--and--pipe-operators" class="uri">https://github.com/kieferk/dfply#the--and--pipe-operators</a></p>
<p><a href="https://github.com/kieferk/dfply" class="uri">https://github.com/kieferk/dfply</a></p>
<div id="安装-1" class="section level2">
<h2><span class="header-section-number">2.1</span> 安装</h2>
<pre><code>pip install dfply</code></pre>
</div>
<div id="函数概览" class="section level2">
<h2><span class="header-section-number">2.2</span> 函数概览</h2>
<div id="和管道操作符" class="section level3">
<h3><span class="header-section-number">2.2.1</span> <code>&gt;&gt;</code>和<code>&gt;&gt;=</code>管道操作符</h3>
<p>在R中,管道操作符为<code>%&gt;%</code>,在python中,改为<code>&gt;&gt;</code>.</p>
<pre class="python"><code>from dfply import *
diamonds &gt;&gt; head(5)</code></pre>
<pre><code>##    carat      cut color clarity  depth  table  price     x     y     z
## 0   0.23    Ideal     E     SI2   61.5   55.0    326  3.95  3.98  2.43
## 1   0.21  Premium     E     SI1   59.8   61.0    326  3.89  3.84  2.31
## 2   0.23     Good     E     VS1   56.9   65.0    327  4.05  4.07  2.31
## 3   0.29  Premium     I     VS2   62.4   58.0    334  4.20  4.23  2.63
## 4   0.31     Good     J     SI2   63.3   58.0    335  4.34  4.35  2.75</code></pre>
<pre class="python"><code>(
diamonds &gt;&gt;
  head(5)
)</code></pre>
<pre><code>##    carat      cut color clarity  depth  table  price     x     y     z
## 0   0.23    Ideal     E     SI2   61.5   55.0    326  3.95  3.98  2.43
## 1   0.21  Premium     E     SI1   59.8   61.0    326  3.89  3.84  2.31
## 2   0.23     Good     E     VS1   56.9   65.0    327  4.05  4.07  2.31
## 3   0.29  Premium     I     VS2   62.4   58.0    334  4.20  4.23  2.63
## 4   0.31     Good     J     SI2   63.3   58.0    335  4.34  4.35  2.75</code></pre>
<p>同样的,如果每一个操作都开始新的一行的话,需要使用小括号将他们括起来.</p>
<p>将处理之后的数据框赋予一个新的变量名的时候,需要注意变量名等号和小括号的左半部分需要在同一行.</p>
<pre class="python"><code>new = (
diamonds &gt;&gt;
  tail(5)
)
new</code></pre>
<pre><code>##        carat        cut color clarity  depth  table  price     x     y     z
## 53935   0.72      Ideal     D     SI1   60.8   57.0   2757  5.75  5.76  3.50
## 53936   0.72       Good     D     SI1   63.1   55.0   2757  5.69  5.75  3.61
## 53937   0.70  Very Good     D     SI1   62.8   60.0   2757  5.66  5.68  3.56
## 53938   0.86    Premium     H     SI2   61.0   58.0   2757  6.15  6.12  3.74
## 53939   0.75      Ideal     D     SI2   62.2   55.0   2757  5.83  5.87  3.64</code></pre>
<p>另外一个管道操作符<code>&gt;&gt;=</code>意味着对原始数据直接进行修改后付给这个变量.</p>
<pre class="python"><code>diamonds2 = diamonds.copy()
diamonds2 &gt;&gt; head(5)</code></pre>
<pre><code>##    carat      cut color clarity  depth  table  price     x     y     z
## 0   0.23    Ideal     E     SI2   61.5   55.0    326  3.95  3.98  2.43
## 1   0.21  Premium     E     SI1   59.8   61.0    326  3.89  3.84  2.31
## 2   0.23     Good     E     VS1   56.9   65.0    327  4.05  4.07  2.31
## 3   0.29  Premium     I     VS2   62.4   58.0    334  4.20  4.23  2.63
## 4   0.31     Good     J     SI2   63.3   58.0    335  4.34  4.35  2.75</code></pre>
<pre class="python"><code>diamonds2 &gt;&gt;= head(5)
diamonds2</code></pre>
<pre><code>##    carat      cut color clarity  depth  table  price     x     y     z
## 0   0.23    Ideal     E     SI2   61.5   55.0    326  3.95  3.98  2.43
## 1   0.21  Premium     E     SI1   59.8   61.0    326  3.89  3.84  2.31
## 2   0.23     Good     E     VS1   56.9   65.0    327  4.05  4.07  2.31
## 3   0.29  Premium     I     VS2   62.4   58.0    334  4.20  4.23  2.63
## 4   0.31     Good     J     SI2   63.3   58.0    335  4.34  4.35  2.75</code></pre>
<pre class="python"><code>diamonds &gt;&gt; head(10)</code></pre>
<pre><code>##    carat        cut color clarity  depth  table  price     x     y     z
## 0   0.23      Ideal     E     SI2   61.5   55.0    326  3.95  3.98  2.43
## 1   0.21    Premium     E     SI1   59.8   61.0    326  3.89  3.84  2.31
## 2   0.23       Good     E     VS1   56.9   65.0    327  4.05  4.07  2.31
## 3   0.29    Premium     I     VS2   62.4   58.0    334  4.20  4.23  2.63
## 4   0.31       Good     J     SI2   63.3   58.0    335  4.34  4.35  2.75
## 5   0.24  Very Good     J    VVS2   62.8   57.0    336  3.94  3.96  2.48
## 6   0.24  Very Good     I    VVS1   62.3   57.0    336  3.95  3.98  2.47
## 7   0.26  Very Good     H     SI1   61.9   55.0    337  4.07  4.11  2.53
## 8   0.22       Fair     E     VS2   65.1   61.0    337  3.87  3.78  2.49
## 9   0.23  Very Good     H     VS1   59.4   61.0    338  4.00  4.05  2.39</code></pre>
</div>
<div id="section" class="section level3">
<h3><span class="header-section-number">2.2.2</span> </h3>
</div>
</div>
</div>
